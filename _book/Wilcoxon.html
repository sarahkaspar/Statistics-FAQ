<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="description" content="Frequently asked questions explained in short stand-alone articles.">
<title>FAQ in statistics - 1&nbsp; The Wilcoxon test</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./hypothesis-tests.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./hypothesis-tests.html">Hypothesis tests</a></li><li class="breadcrumb-item"><a href="./Wilcoxon.html"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">The Wilcoxon test</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">FAQ in statistics</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/coatless-tutorials/quarto-book-template" rel="" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
<li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=%7Curl%7C">
              <i class="bi bi-bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=%7Curl%7C">
              <i class="bi bi-bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.linkedin.com/sharing/share-offsite/?url=%7Curl%7C">
              <i class="bi bi-bi-linkedin pe-1"></i>
            LinkedIn
            </a>
          </li>
      </ul>
</div>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./hypothesis-tests.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hypothesis tests</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Wilcoxon.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">The Wilcoxon test</span></span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#why-non-parametric-tests" id="toc-why-non-parametric-tests" class="nav-link active" data-scroll-target="#why-non-parametric-tests"><span class="header-section-number">1.1</span> Why non-parametric tests?</a></li>
  <li><a href="#assumptions-null-and-alternative-hypothesis" id="toc-assumptions-null-and-alternative-hypothesis" class="nav-link" data-scroll-target="#assumptions-null-and-alternative-hypothesis"><span class="header-section-number">1.2</span> Assumptions, null and alternative hypothesis</a></li>
  <li><a href="#rank-transformation" id="toc-rank-transformation" class="nav-link" data-scroll-target="#rank-transformation"><span class="header-section-number">1.3</span> Rank transformation</a></li>
  <li><a href="#the-u-statistic" id="toc-the-u-statistic" class="nav-link" data-scroll-target="#the-u-statistic"><span class="header-section-number">1.4</span> The U statistic</a></li>
  <li><a href="#from-u-statistic-to-p-value" id="toc-from-u-statistic-to-p-value" class="nav-link" data-scroll-target="#from-u-statistic-to-p-value"><span class="header-section-number">1.5</span> From U statistic to p-value</a></li>
  <li><a href="#running-the-test-in-r" id="toc-running-the-test-in-r" class="nav-link" data-scroll-target="#running-the-test-in-r"><span class="header-section-number">1.6</span> Running the test in R</a></li>
  <li><a href="#comparison-to-t-test" id="toc-comparison-to-t-test" class="nav-link" data-scroll-target="#comparison-to-t-test"><span class="header-section-number">1.7</span> Comparison to t-test</a></li>
  <li><a href="#what-other-methods-to-consider-if-your-data-are-not-normal" id="toc-what-other-methods-to-consider-if-your-data-are-not-normal" class="nav-link" data-scroll-target="#what-other-methods-to-consider-if-your-data-are-not-normal"><span class="header-section-number">1.8</span> What other methods to consider if your data are not normal</a></li>
  </ul><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/coatless-tutorials/quarto-book-template/edit/main/Wilcoxon.qmd" class="toc-action">Edit this page</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title">
<span class="chapter-number">1</span>&nbsp; <span class="chapter-title">The Wilcoxon test</span>
</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><p>The Wilcoxon, or Mann-Whitney U test, is a non-parametric independence test that is used to compare two groups.</p>
<p>We can apply it on data that consists of two groups, <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>, for example a “control” and a “treatment” group, where in both we measure the same biological indicator of some effect.</p>
<section id="why-non-parametric-tests" class="level2" data-number="1.1"><h2 data-number="1.1" class="anchored" data-anchor-id="why-non-parametric-tests">
<span class="header-section-number">1.1</span> Why non-parametric tests?</h2>
<p>In the example below, you see data from an experiment where the effect of different conditions on plant growth was investigated.</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="va">myplants</span> <span class="op">&lt;-</span> <span class="va">PlantGrowth</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">group</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ctrl"</span>, <span class="st">"trt1"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">myplants</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">group</span>, y <span class="op">=</span> <span class="va">weight</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html">geom_jitter</a></span><span class="op">(</span>width<span class="op">=</span><span class="fl">0.07</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Wilcoxon_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Here, the groups <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> correspond to “ctrl” and “trt”, and we want to find out whether the weight is different between them. In an example like this, we would typically use a <strong>t-test</strong>, which calculates the mean and variance of both groups and checks for a difference in means. This comparison of means assumes that the data are somewhat well described by the two group means, meaning that in each group, the data points are roughly centered around their mean, and have no huge outliers. The t-test is a <strong>parametric</strong> test, because it makes assumptions about the distribution of the data (such as outlined above) and estimates parameters, namely mean and standard deviation, which describe a normal distribution.</p>
<p>Below, you see another example, where the t-test is not advised. In the <code><a href="https://rdrr.io/pkg/coin/man/rotarod.html">coin::rotarod</a></code> data set, rats were assigned to two different treatment groups, and of each rat the time it managed to blanace on a rotating cylinder (without falling off) was measured.</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://coin.r-forge.r-project.org">coin</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Lade nötiges Paket: survival</code></pre>
</div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/eclarke/ggbeeswarm">ggbeeswarm</a></span><span class="op">)</span></span>
<span><span class="va">rotarod</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">group</span>, y <span class="op">=</span> <span class="va">time</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggbeeswarm/man/geom_beeswarm.html">geom_beeswarm</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Wilcoxon_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The experiment stopped at 300 s. As you see in the data above, all of the rats in the control group made it to the end without falling, whereas in the treatment group, 5 rats dropped out earlier. This data is not well described by group means and standard deviation, for several reasons:</p>
<ul>
<li>the data are censored, i.e.&nbsp;cut off at 300s, and therefore also skewed.</li>
<li>No standard deviation can be determined for the control group, because all rats have the same time.</li>
</ul>
<p>For this data, a Wilcoxon test is a better choice, because it is <strong>non-parametric</strong>, i.e.&nbsp;it does not try to fit a distribution to the data. Instead, it transforms the data into ranks, as we will see below.</p>
</section><section id="assumptions-null-and-alternative-hypothesis" class="level2" data-number="1.2"><h2 data-number="1.2" class="anchored" data-anchor-id="assumptions-null-and-alternative-hypothesis">
<span class="header-section-number">1.2</span> Assumptions, null and alternative hypothesis</h2>
<p>Even though no specific distribution is assumed when applying the Wilcoxon test, some assumptions are still made (see <a href="https://en.wikipedia.org/wiki/Mann%E2%80%93Whitney_U_test">Wikipedia</a>:</p>
<ol type="1">
<li>All the observations from both groups are independent of each other,</li>
<li>The responses are at least ordinal (i.e., one can at least say, of any two observations, which is the greater),</li>
<li>Under the null hypothesis <span class="math inline">\(H_0\)</span>, the distributions of both populations are identical.</li>
</ol>
<p>If you don’t know what “independence” means in the statistics context, have a look <a href="https://sarahkaspar.github.io/biostatistics-course/01-sampling.html">here</a>.</p>
<p>To approach the difference between groups without calculating for example a mean, the null hypothesis is described as follows.</p>
<p><span class="math display">\[H_0: P(X &gt; Y) = P(Y &gt; X)\]</span></p>
<p>In words: If taking any to measurements <span class="math inline">\(x_i\)</span> and <span class="math inline">\(x_j\)</span> from <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>, the chance of <span class="math inline">\(x_i\)</span> being greater than <span class="math inline">\(y_i\)</span> is the same as vice versa.</p>
<p>The alternative hypothesis is that this probability is not the same: <span class="math display">\[H_A: P(X &gt; Y) = P(Y &gt; X)\]</span></p>
<p>An intuitive <strong>interpretation</strong> is therefore that the test detects differences in median.</p>
</section><section id="rank-transformation" class="level2" data-number="1.3"><h2 data-number="1.3" class="anchored" data-anchor-id="rank-transformation">
<span class="header-section-number">1.3</span> Rank transformation</h2>
<p>If we are investigating the probability of <span class="math inline">\(Y&gt;X\)</span>, the exact numbers of the data points in <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> do not matter. For example, if <span class="math inline">\(x_i = 2\)</span> and <span class="math inline">\(y_j=2.2\)</span>, then <span class="math inline">\(x_i&lt;y_j\)</span>. But if <span class="math inline">\(y_j = 200\)</span> instead, then we still have <span class="math inline">\(x_i&lt;y_j\)</span>. It’s only about the order of the data points.</p>
<p>The order of data points can be encoded as <strong>ranks</strong>. For the Wilcoxon test, we rank all the data (ignoring the groups). This means we give rank 1 to the lowest value, rank 2 to the second lowest, and so on. Let’s look at the ranks for a subset of the plants data.</p>
<p>We create a subset:</p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">plants_subset</span> <span class="op">&lt;-</span> <span class="va">myplants</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="fl">11</span><span class="op">:</span><span class="fl">15</span><span class="op">)</span>,<span class="op">]</span></span>
<span><span class="va">plants_subset</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   weight group
1    4.17  ctrl
2    5.58  ctrl
3    5.18  ctrl
4    6.11  ctrl
5    4.50  ctrl
11   4.81  trt1
12   4.17  trt1
13   4.41  trt1
14   3.59  trt1
15   5.87  trt1</code></pre>
</div>
</div>
<p>Now we assign ranks:</p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">plants_subset</span> <span class="op">&lt;-</span> <span class="va">plants_subset</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>rank<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rank.html">rank</a></span><span class="op">(</span><span class="va">weight</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">plants_subset</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">rank</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   weight group rank
1    3.59  trt1  1.0
2    4.17  ctrl  2.5
3    4.17  trt1  2.5
4    4.41  trt1  4.0
5    4.50  ctrl  5.0
6    4.81  trt1  6.0
7    5.18  ctrl  7.0
8    5.58  ctrl  8.0
9    5.87  trt1  9.0
10   6.11  ctrl 10.0</code></pre>
</div>
</div>
<p>You can see that the <code>rank</code> columns contains the values from 1 to 10 - or almost. The values 2 and 3 are missing, because there is a <em>tie</em>: The measurement <span class="math inline">\(4.17\)</span> (the second lowest) appears twice. Therefore, both measurements get rank <span class="math inline">\(2.5\)</span>.</p>
</section><section id="the-u-statistic" class="level2" data-number="1.4"><h2 data-number="1.4" class="anchored" data-anchor-id="the-u-statistic">
<span class="header-section-number">1.4</span> The U statistic</h2>
<p>A test statistic is a value that gets extreme (extremely large or extremely small) in case there is a difference between the two group - or, in other words: in case there is evidence for a deviation from the null hypothesis.</p>
<p>A simple approach to compare the two groups is to sum up the ranks within each group and compare them. We can do this for our example:</p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">plants_subset</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">group</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>rank_sum <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">rank</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  group rank_sum
  &lt;fct&gt;    &lt;dbl&gt;
1 ctrl      32.5
2 trt1      22.5</code></pre>
</div>
</div>
<p>This tells us that the control group has a lower rank sum, i.e.&nbsp;on average the ranks in the control group are smaller. The next thing we need to find out is how unlikely it is to see a difference in rank sums like this by chance, if in reality <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> come from the same distribution.</p>
<p><strong>Intuitively</strong>, we can compare the observed rank sums to what we expect in a few extreme cases. For example:</p>
<ul>
<li>If the control group had <em>all</em> the lower ranks we would see rank sum <span class="math inline">\(R_x = 1+2+3+4+5 = 15\)</span> for <code>ctrl</code> and <span class="math inline">\(R_y = 6+7+8+9+10 = 40\)</span> for <code>trt1</code>. (And vice versa.)</li>
<li>If the ranks were completely evenly distributed among the two groups, we’d see the same rank sum, <span class="math inline">\(R_x=R_y=55\)</span>, in both groups.</li>
</ul>
<p>Our example seems to be somewhat in the middle.</p>
<p><strong>In the test</strong>, we use the <strong>Mann-Whitney U statistic</strong>, of which we know the distribution (behavior) under the null hypothesis. It is defined as</p>
<p><span class="math display">\[U = min(U_x, U_y)\]</span> with</p>
<p><span class="math display">\[U_x = n_xn_y + \frac{n_x(n_x + 1)}{2} - R_x \]</span> and <span class="math display">\[U_y = n_xn_y + \frac{n_y(n_y + 1)}{2} - R_y \]</span>.</p>
<p>Let’s dissect this.</p>
<p><span class="math inline">\(R_x\)</span> and <span class="math inline">\(R_y\)</span> are the rank sums that we already calculated for our example. In the <span class="math inline">\(U_x\)</span>, the rank sum <span class="math inline">\(R_x\)</span> gets subtracted from the term <span class="math display">\[n_xn_y + \frac{n_x(n_x + 1)}{2}\]</span> This is the rank sum that we’d expect in case <span class="math inline">\(X\)</span> had all the upper ranks. That expected rank sum depends on <span class="math inline">\(n_x\)</span> and <span class="math inline">\(n_y\)</span>, the number of data points in <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>, respectively. We calculated it by hand for the example above, and this calculation can be abstracted to the term you see here.</p>
<p>Since <span class="math display">\[U_x = \text{expectation if X has all the upper ranks} - R_x\]</span>, <span class="math inline">\(U_x\)</span> will be</p>
<ul>
<li>0 if <span class="math inline">\(Y\)</span> in fact <em>has</em> all the upper ranks,</li>
<li>close to 0 if <span class="math inline">\(X\)</span> has mostly upper ranks, and</li>
<li>
<span class="math inline">\(\gg0\)</span> if <span class="math inline">\(X\)</span> has intermediate or lower ranks.</li>
</ul>
<p>The same logic applies for <span class="math inline">\(U_y\)</span>. By taking the minimum of <span class="math inline">\(U_x\)</span> and <span class="math inline">\(U_y\)</span>, we will have</p>
<ul>
<li>a <span class="math inline">\(U\)</span> that is low / close to 0 if either <span class="math inline">\(X\)</span> or <span class="math inline">\(Y\)</span> have mostly upper ranks and</li>
<li>high otherwise.</li>
</ul>
<p>In summary, a low <span class="math inline">\(U\)</span> represents evidence for <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> being different, represented as a difference in rank sums.</p>
</section><section id="from-u-statistic-to-p-value" class="level2" data-number="1.5"><h2 data-number="1.5" class="anchored" data-anchor-id="from-u-statistic-to-p-value">
<span class="header-section-number">1.5</span> From U statistic to p-value</h2>
<p>Per definition, the p-value is the probability of seeing data (i.e.&nbsp;a test statistic) at least as extreme as what as actually observed, under the assumption that the null hypothesis is true.</p>
<p>If the probability of our data under the null hypothesis is small (usually: <span class="math inline">\(p&lt;0.05\)</span>), we reject the null hypothesis and report a significant difference between the two groups.</p>
<p>For calculating <span class="math inline">\(p\)</span>, we need knowledge how the test statistic behaves under the null hypothesis, specifically we need to know its <strong>null distribution</strong>.</p>
<p>There are different ways of getting to this distribution and thus the p-value, which will lead to small differences in the resulting p-value. Two examples are:</p>
<ul>
<li>Combinatorics: The null hypothesis says that the two groups come from the same distribution and thus the probability of <span class="math inline">\(P(X&gt;Y) = P(Y&gt;X)\)</span>. All ranks therefore have the same chance for all the data points. One can thus spell out all combinations of ranks and data points and calculate the corresponding <span class="math inline">\(U\)</span> for getting the null distribution. The p-value is the percentage of possible <span class="math inline">\(U\)</span>s that are smaller or equal to the observed one. (In practice, one doesn’t spell out all possibilities, but combinatorics allows to calculate <span class="math inline">\(p\)</span> directly.)</li>
<li>For larger sample sizes (<span class="math inline">\(n&gt;20\)</span>), the distribution of <span class="math inline">\(U\)</span> can be approximated by a normal distribution.</li>
</ul>
<p>If you use the R implementation of the <code>wilcox.test</code>, the documentation reads: &gt; By default (if exact is not specified), an exact p-value is computed if the samples contain less than 50 finite values and there are no ties. Otherwise, a normal approximation is used.</p>
<p>You are usually fine with sticking to the default. You may see slightly different results from different packages due to small differences in their defaults. Again, in most cases, these don’t impact the conclusion. If they do, it’s time to further investigate which method fits your data best.</p>
</section><section id="running-the-test-in-r" class="level2" data-number="1.6"><h2 data-number="1.6" class="anchored" data-anchor-id="running-the-test-in-r">
<span class="header-section-number">1.6</span> Running the test in R</h2>
<p>Applying the built-in test to the example subset gives:</p>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/wilcox.test.html">wilcox.test</a></span><span class="op">(</span><span class="va">weight</span> <span class="op">~</span> <span class="va">group</span>, data <span class="op">=</span> <span class="va">plants_subset</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in wilcox.test.default(x = DATA[[1L]], y = DATA[[2L]], ...): kann bei
Bindungen keinen exakten p-Wert Berechnen</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Wilcoxon rank sum test with continuity correction

data:  weight by group
W = 17.5, p-value = 0.3457
alternative hypothesis: true location shift is not equal to 0</code></pre>
</div>
</div>
<p><strong>Advanced</strong>: There is another implementation of the Wilcoxon test in the <code>coin</code> package, which allows more flexibility in calculating the test statistic and null distribution, and allows stratifying the test among blocking factors. Example for usage:</p>
<div class="cell">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">coin</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coin/man/LocationTests.html">wilcox_test</a></span><span class="op">(</span><span class="va">weight</span> <span class="op">~</span> <span class="va">group</span>, data <span class="op">=</span> <span class="va">plants_subset</span>, distribution<span class="op">=</span><span class="st">"approximate"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Approximative Wilcoxon-Mann-Whitney Test

data:  weight by group (ctrl, trt1)
Z = 1.0476, p-value = 0.3365
alternative hypothesis: true mu is not equal to 0</code></pre>
</div>
</div>
<p>We can also run the test for the whole <code>plantGrowth</code> and <code>rotarod</code> data sets:</p>
<div class="cell">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/wilcox.test.html">wilcox.test</a></span><span class="op">(</span><span class="va">time</span> <span class="op">~</span> <span class="va">group</span>, <span class="va">rotarod</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in wilcox.test.default(x = DATA[[1L]], y = DATA[[2L]], ...): kann bei
Bindungen keinen exakten p-Wert Berechnen</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Wilcoxon rank sum test with continuity correction

data:  time by group
W = 102, p-value = 0.01647
alternative hypothesis: true location shift is not equal to 0</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/wilcox.test.html">wilcox.test</a></span><span class="op">(</span><span class="va">weight</span> <span class="op">~</span> <span class="va">group</span>, <span class="va">myplants</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in wilcox.test.default(x = DATA[[1L]], y = DATA[[2L]], ...): kann bei
Bindungen keinen exakten p-Wert Berechnen</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Wilcoxon rank sum test with continuity correction

data:  weight by group
W = 67.5, p-value = 0.1986
alternative hypothesis: true location shift is not equal to 0</code></pre>
</div>
</div>
</section><section id="comparison-to-t-test" class="level2" data-number="1.7"><h2 data-number="1.7" class="anchored" data-anchor-id="comparison-to-t-test">
<span class="header-section-number">1.7</span> Comparison to t-test</h2>
<p>For the same data sets the t-test will give the following results:</p>
<div class="cell">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/t.test.html">t.test</a></span><span class="op">(</span><span class="va">weight</span> <span class="op">~</span> <span class="va">group</span>, <span class="va">myplants</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Welch Two Sample t-test

data:  weight by group
t = 1.1913, df = 16.524, p-value = 0.2504
alternative hypothesis: true difference in means between group ctrl and group trt1 is not equal to 0
95 percent confidence interval:
 -0.2875162  1.0295162
sample estimates:
mean in group ctrl mean in group trt1 
             5.032              4.661 </code></pre>
</div>
</div>
<p>The t-test gives a comparable result for the <code>plantGrowth</code> data set, coming to the same conclusion that the difference in weights is not significant between <code>ctrl</code> and <code>trt1</code>. In most casese where the t-test can be used, it’s also OK to use the Wilcoxon test. One caveat is that in the Wilcoxon test, we drop all the information on the actual values of the data points. This, in combination with making less assumptions on the data, can sometimes make it harder to detect a significant deviation of the data from the our null assumption. This is especially relevant for small data sets. We say that the <strong>t-test has a higher power than the Wilcoxon test</strong>, meaning that if there is a difference between the groups, the t-test is often better in detecting it.</p>
<p>The limitations of the rank-based test become clear when we look at very small data sets. Consider two groups with only 3 data points each. There are only 20 ways to distribute 6 ranks among 2 groups.</p>
<div class="cell">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Special.html">choose</a></span><span class="op">(</span><span class="fl">6</span>,<span class="fl">3</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 20</code></pre>
</div>
</div>
<p>A two-sided p-value will therefore never be below <span class="math inline">\(\frac{1}{20}\cdot 2\)</span>. To demonstrate:</p>
<div class="cell">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span> <span class="co"># x has all the lower ranks</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fl">4</span><span class="op">:</span><span class="fl">6</span> <span class="co"># y has all the upper ranks</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/wilcox.test.html">wilcox.test</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Wilcoxon rank sum exact test

data:  x and y
W = 0, p-value = 0.1
alternative hypothesis: true location shift is not equal to 0</code></pre>
</div>
</div>
</section><section id="what-other-methods-to-consider-if-your-data-are-not-normal" class="level2" data-number="1.8"><h2 data-number="1.8" class="anchored" data-anchor-id="what-other-methods-to-consider-if-your-data-are-not-normal">
<span class="header-section-number">1.8</span> What other methods to consider if your data are not normal</h2>
<p>The Wilcoxon test is usually used when the data are not normally distributed, so a t-test doesn’t apply. However, there are also other approaches that might apply:</p>
<ul>
<li>The data might follow another known distribution around the group means, such as Poisson, or binomial. In this case, you can have a look at Poisson ANOVA or Fisher test.</li>
<li>The data might fulfill the normality criterion after a transformation. A common one is the log-transformation.</li>
</ul>


</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./hypothesis-tests.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Hypothesis tests</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->



</body></html>